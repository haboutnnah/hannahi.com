#!/usr/bin/env bash

# Set up colours
CYAN='\033[1;36'
NC='\033[0m'
# Terminate script if there is an error

set -e

# Node Project Manager

echo -e "${CYAN}Installing Node Package Manager${NC}\n"
npm install

echo -e "${CYAN}Installing AMP Validator${NC}\n"
npm install -g amphtml-validator

# Ruby Gems

echo -e "${CYAN}Installing Jekyll${NC}\n"
gem install jekyll

echo -e "${CYAN}Installing HTML Proofer${NC}\n"
gem install html-proofer

echo -e "${CYAN} Installing Jekyll Redirect From gem${NC}\n"
gem install jekyll-redirect-from

echo -e "${CYAN} Installing Jekyll Sitemap gem${NC}\n"
gem install jekyll-sitemap

# Bundler Gems 

echo -e "${CYAN}Installing required Ruby gems${NC}\n"
bundle install

# Jekyll compile and start server

echo -e "${CYAN}Building jekyll and setting up server${NC}\n"
bundle exec jekyll serve &

# HTML Proofer

echo -e "${CYAN}Testing HTML and links of the frontpage${NC}\n"
bundle exec htmlproofer http://127.0.0.1:4000/index.html

echo -e "${CYAN}Testing HTML and links of the Pokemon Go resource disambiguation page${NC}\n"
bundle exec htmlproofer http://127.0.0.1:4000/PokemonGo/index.html

echo -e "${CYAN}Testing HTML and links of the current Pokemon Go strings page${NC}\n"
bundle exec htmlproofer http://127.0.0.1:4000/PokemonGo/PokemonGoStrings.html

echo -e "${CYAN}Testing HTML and links of the Pokemon Go strings at launch${NC}\n"
bundle exec htmlproofer http://127.0.0.1:4000/PokemonGo/old/PokemonGoStrings.html

echo -e "${CYAN}Testing HTML and links of the expanded Pokemon Go strings at launch${NC}\n"
bundle exec htmlproofer http://127.0.0.1:4000/PokemonGo/old/PokemonGoStringsFull.html

echo -e "${CYAN}Testing HTML and links of the AMP frontpage${NC}\n"
bundle exec htmlproofer http://127.0.0.1:4000/amp/index.html

# AMP Validator

echo -e "${CYAN}Verifying AMP formatting of AMP frontpage${NC}\n"
amphtml-validator http://127.0.0.1:4000/amp/index.html